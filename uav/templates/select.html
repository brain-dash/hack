<!doctype html>
<html lang="ru">
<head>
    {% load static %}

    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">

    <script defer src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <script defer src="{% static 'js/add-bpla.js' %}"></script>
    <script defer src="{% static 'js/table-el-bpla.js' %}"></script>
    <script defer src="{% static 'js/prev.js' %}"></script>
    <script defer src="{% static 'js/account.js' %}"></script>
    <script defer src="{% static 'js/main.js' %}"></script>
    <script defer src="{% static 'js/button.js' %}"></script>


    <title>Управление БПЛА</title>
</head>
<body>
    <header class="header-secondary">
        <bpla-prev></bpla-prev>
        <bpla-account><p>{{user}}</p></bpla-account>
    </header>
    <h1> Выберите БПЛА из списка или добавьте новый </h1>
  
    <form id="createTaskFormBpla" >
        <div class="modal-body w-80 bpla-dropdown">
          <div class="dropdown">
            <button type="submit" class="btn btn-light dropdown-toggle dropdown-custom" type="button" data-bs-toggle="dropdown" aria-expanded="false">
              Список БПЛА
            </button>
            <ul class="dropdown-menu">
              <li>
                <div class="form-check dropdown-item">
                  <input class="form-check-input bpla-list" type="radio" name="bpla" id="bpla1" value="БПЛА1">
                  <label class="form-check-label bpla-label" for="bpla1">
                    БПЛА 1
                  </label>
                </div>
              </li>
              <li> 
                <div class="form-check dropdown-item">
                  <input class="form-check-input bpla-list" type="radio" name="bpla" id="bpla2" value="БПЛА2">
                  <label class="form-check-label bpla-label" for="bpla2">
                  БПЛА 2
                  </label>
                </div>
              </li>
            </ul>
          </div>
        </div>
        <bpla-add-bpla></bpla-add-bpla>
        <button class="btn btn-primary button-like" data-bs-toggle="modal" data-bs-target="#createTask"   type="submit">Подтвердить БПЛА</button>
      </form>
      
      <!-- Modal -->
      <div class="modal fade " id="createTask" aria-hidden="true" aria-labelledby="createTaskLabel" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title form-control " id="bpla-name"  id="createTaskLabel"> Выбор маршрута</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>  
            <form id="createTaskForm" >
              <div class="modal-body">
                <div class="dropdown">
                  <button class="btn btn-secondary dropdown-toggle dropdown-custom " type="button" data-bs-toggle="dropdown" aria-expanded="false">
                   Маршруты
                  </button>
                  <ul class="dropdown-menu" id="bpla-dropdown-list">
                    <li>
                      <div class="form-check dropdown-item">
                        <input class="f e="route" id="route1" value="Маршрут1">
                        <label class="form-check-label" for="route1">
                          Маршрут 1
                        </label>
                      </div>
                    </li>
                    <li> 
                      <div class="form-check dropdown-item ">
                        <input class="form-check-input" type="radio" name="bpla" id="route2" value="Маршрут2">
                        <label class="form-check-label" for="route2">
                        Маршрут 2
                        </label>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn btn-primary button-like" data-bs-target="#createTask2" data-bs-toggle="modal"  type="submit">Подтвердить маршрут</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="modal fade" id="createTask2" aria-hidden="true" aria-labelledby="createTaskLabel2" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="createTaskLabel2">Запустить ${this.tasks?.bpla} по маршруту ${this.tasks?.route}</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
            <div class="modal-body">
              Картинка с маршрутом
            </div>
            <div class="modal-footer">
                <form class="w-80 d-flex justify-content-center" id="createTaskSubmit" action="api/createProblem" method="post" >
                    <input id="name_vua" type="hidden" name="name_vua">
                    <input id="name_routea" type="hidden" name="name_route">
                    <button class="btn btn-primary button-like" data-bs-dismiss="modal" type="submit">Подтвердить задание</button>
                </form>
            </div>
        </div>
    </div>
      </div>
    
      <script>
        document.querySelector("#createTaskFormBpla").addEventListener('submit', (e)=>handlerSubmit1(e));
        document.querySelector("#createTaskForm").addEventListener('submit', (e)=>handlerSubmit(e));
        document.querySelector("#createTaskSubmit").addEventListener('submit', (e)=>handlerSubmit3(e));
        
        let taskObject = {};
        console.log(document.querySelector("#createTaskFormBpla"));
        const handlerSubmit1 = (e) =>{
            e.preventDefault();
            const formData = new FormData(e.target);
            let formProps = Object.fromEntries(formData);
            Object.assign(taskObject,formProps)
          
        }
        const handlerSubmit = (e) =>{
            e.preventDefault();
            const formData = new FormData(e.target);
            let formProps = Object.fromEntries(formData);
            Object.assign(taskObject,formProps)
            document.querySelector("#createTaskLabel2").innerHTML =`Запустить ${taskObject?.bpla} по маршруту ${taskObject?.route} ?`
            document.querySelector("#name_vua").value = taskObject.bpla;
            document.querySelector("#name_route").value = taskObject.route;
        }
        (async () =>{
        let response = await fetch('/api/getRoute');
        let json = await response.json(); // прочитать тело ответа как текст
        const container = document.querySelector(".bpla-list-container");
        json.forEach(element => {
            // let bpla = document.createElement('bpla-table-bpla');
            const bpla = document.createElement("bpla-table-bpla");
            bpla.setAttribute("status",element.status);
            bpla.setAttribute("name",element.name);
            container.appendChild(bpla)
            
        });
    })()
      </script>
</body>
</html>