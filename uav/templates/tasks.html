<!doctype html>
<html lang="ru">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">


    <script defer src="{% static 'bootstrap.bundle.min.js' %}"></script>
    <script defer src="{% static 'js/add-route.js' %}"></script>
    <script defer src="{% static 'js/account.js' %}"></script>
    <script defer src="{% static 'js/main.js' %}"></script>
    <script defer src="{% static 'js/table-el-task.js' %}"></script>
    <script defer src="{% static 'js/prev.js' %}"></script>
    <script defer src="{% static 'js/button.js' %}"></script>
    <script defer src="{% static 'js/view.js' %}"></script>
    <script defer src="{% static 'js/characteristics.js' %}"></script>



    <title>Управление БПЛА</title>
</head>
<body>
    <header class="header-secondary">
        <bpla-prev></bpla-prev>
        <bpla-account></bpla-account>
    </header>
    <h1> Активные задания </h1>
    <div class="bpla-list-container">
        <bpla-table-task>
            <p slot="name"> БПЛА 1</p>
            <p slot="route"> Маршрут 1</p>
            <p slot="time"> 30 мин</p>
        </bpla-table-task>
        <bpla-table-task>
            <p slot="name"> БПЛА 2</p>
            <p slot="route"> Маршрут 2</p>
            <p slot="time"> 1ч 8мин</p>
        </bpla-table-task>
    </div>
    
    <script>
        //console.log("/api/")
        (async () =>{
            let response = await fetch('/api/getProblem');
            let json = await response.json(); // прочитать тело ответа как текст
            const container = document.querySelector(".bpla-list-container");
            json.forEach(element => {
                const task = document.createElement("bpla-table-bpla");
                bpla.setAttribute("status",element.status);
                bpla.setAttribute("name",element.name);
                bpla.token='{{ csrf_token }}';
                // bpla.innerHTML='{{ csrf_token }}';
                container.appendChild(bpla)
                
            });
    
    
            let xhr = new XMLHttpRequest(); 
            let url = new URL('http://127.0.0.1:8000/api/getCharacteristics');
            url.searchParams.set('name', "2");
            const body = {
                'name' : 12
            } 
            xhr.open('POST', url);
            xhr.setRequestHeader('csrftoken', '{{ csrf_token }}'); 
            xhr.send([body]);
            xhr.onload = () => {
            console.log(`Загружено: ${xhr.status} ${xhr.response}`);
            };
        })()
        
    </script>
</body>
</html>